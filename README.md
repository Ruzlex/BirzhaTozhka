# Биржа Игрушек API

Это простое RESTful API, написанное на FastAPI, для демонстрации системы биржи игрушек (или инструментов).

## Основные функции

- Регистрация пользователей и администраторов
- Аутентификация через API-ключи
- Работа с инструментами (акциями) - просмотр, добавление, удаление
- Контроль доступа на основе ролей пользователей

## Требования

- Python 3.8+
- PostgreSQL
- Зависимости из requirements.txt

## Установка и запуск

1. Клонируйте репозиторий:
   ```bash
   git clone <url-репозитория>
   cd BirzhaTozhka
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Настройте подключение к базе данных в файле `app/database.py`:
   ```python
   SQLALCHEMY_DATABASE_URL = "postgresql://username:password@localhost/dbname"
   ```

4. Запустите сервер:
   ```bash
   uvicorn app.main:app --reload
   ```

## Использование API

После запуска сервера, вы можете открыть веб-браузер и перейти по адресу:
```
http://localhost:8000/docs
```

Это откроет Swagger UI, где вы сможете протестировать все доступные эндпоинты.

### Процесс авторизации:

1. Зарегистрируйтесь, используя один из эндпоинтов:
   - `/api/v1/public/register` - для обычного пользователя
   - `/api/v1/public/register-admin` - для администратора (только для тестирования)

2. Сохраните полученный API-ключ из ответа (начинается с префикса `toy_`).

3. Нажмите кнопку "Authorize" вверху страницы Swagger UI:
   - В поле ввода введите ваш API-ключ (можно с префиксом "Bearer ")
   - Нажмите "Authorize" и затем "Close"

4. Теперь вы можете использовать все защищенные API-методы.

### Основные эндпоинты:

- **Публичные эндпоинты**:
  - `POST /api/v1/public/register` - Регистрация нового пользователя
  - `POST /api/v1/public/register-admin` - Регистрация администратора (тестовый эндпоинт)
  - `GET /api/v1/public/instrument` - Получение списка всех инструментов

- **Защищенные эндпоинты** (требуется авторизация):
  - `GET /api/v1/users/me` - Получение профиля текущего пользователя

- **Административные эндпоинты** (требуется роль ADMIN):
  - `POST /api/v1/admin/instrument` - Создание нового инструмента
  - `DELETE /api/v1/admin/instrument/{ticker}` - Удаление инструмента по тикеру

- **Отладочные эндпоинты**:
  - `GET /debug/headers` - Проверка заголовков запроса (полезно для отладки авторизации)

## Роли пользователей

- **USER** - обычный пользователь, имеет доступ к своему профилю
- **ADMIN** - администратор, имеет дополнительные права на управление инструментами

## Формат API-ключа

Все API-ключи имеют формат `toy_xxxxxxxxxxxxxxxxxxxx`, где `x` - случайный символ.
Ключ нужно передавать в заголовке `authorization` каждого запроса.


